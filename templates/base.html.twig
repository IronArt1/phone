<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>{% block title %}Welcome!{% endblock %}</title>
        <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%221.2em%22 font-size=%2296%22>⚫️</text><text y=%221.3em%22 x=%220.2em%22 font-size=%2276%22 fill=%22%23fff%22>sf</text></svg>">
        {% block stylesheets %}
            <style>
                .header-phone-element {
                    display: flex;
                    justify-content: center;
                }
                .header-phone-element__info {
                    height: 3rem;
                    width: 99%;
                    display: flex;
                    justify-content: right;
                    background: #F4FBFE;
                    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.26);
                    margin: 0.5rem;
                }
                .header-phone-element__info p {
                    margin-right: 2rem;
                    font-size: 1.1rem;
                    font-weight: bold;
                }
                .footer-phone-element {
                    display: flex;
                    justify-content: center;
                    bottom: 0;
                    position: fixed;
                    width: 99.3%;;
                    margin-bottom: 1rem;
                }
                .footer-phone-element__info {
                    height: 3rem;
                    width: 99%;
                    display: flex;
                    justify-content: center;
                    background: #F4FBFE;
                    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.26);
                    margin: 0.5rem;
                    padding: 1rem;
                }
                .footer-phone-element__info p {
                    margin-right: 2rem;
                    font-size: 1.1rem;
                    font-weight: bold;
                }

            </style>
        {% endblock %}
    </head>
    <body>
        {% block body %}{% endblock %}
    </body>
    {% block javascripts %}
        <script>
            let headerElement, footerElement;

            class ElementAttribute
            {
                constructor(name, value)
                {
                    this.name = name;
                    this.value = value;
                }
            }

            class Component {
                constructor(tag) {
                    this.tag = tag;
                }

                createElement(name, classes, attributes = [], child)
                {
                    const newEl = document.createElement(name),
                        appElement = document.getElementById(this.tag);

                    if (classes) {
                        newEl.className = classes;
                    }

                    if (attributes.length) {
                        for (const attr of attributes) {
                            newEl.setAttribute(attr.name, attr.value);
                        }
                    }

                    if (child) {
                        appElement.insertBefore(newEl, child);
                    } else {
                        appElement.append(newEl);
                    }

                    return newEl;
                }
            }

            class HeaderPhoneInfo extends Component {
                phone = '';

                constructor(tag, phone) {
                    super(tag);
                    this.phone = phone;
                    this.render();
                }

                render() {
                    this.headerPhoneInfo = this.createElement(
                        'div',
                        'header-phone-element__info',
                    );
                    this.headerPhoneInfo.innerHTML = `<p id='header-phone-locator'>Telephone: 8-800-<span id='headerPhonePlaceHolder'>${this.phone}</span></p>`;
                }

                setUpPhone(phone) {
                    this.headerPhoneInfo.querySelector('#headerPhonePlaceHolder').innerHTML = phone;
                }
            }

            class HeaderPhone extends Component {
                constructor(tag) {
                    super(tag);
                    this.render();
                }

                render() {
                    this.createElement(
                        'div',
                        'header-phone-element',
                        [new ElementAttribute('id', 'header-phone')],
                        document.querySelector('.example-wrapper')
                    );
                    this.headerPhoneInfo = new HeaderPhoneInfo('header-phone', 'DIGITS')
                }
            }

            class FooterPhone extends Component {
                constructor(tag) {
                    super(tag);
                    this.render();
                }

                render() {
                    this.createElement(
                        'div',
                        'footer-phone-element',
                        [new ElementAttribute('id', 'footer-phone')]
                    );
                    this.footerPhoneInfo = new FooterPhoneInfo('footer-phone', 'DIGITS')
                }
            }

            class FooterPhoneInfo extends Component {
                phone = '';

                constructor(tag, phone) {
                    super(tag);
                    this.phone = phone;
                    this.render();
                }

                render() {
                    this.footerPhoneInfo = this.createElement(
                        'div',
                        'footer-phone-element__info',
                    );
                    this.footerPhoneInfo.innerHTML = `<p id='footer-phone-locator'>Telephone: 8-800-<span id='footerPhonePlaceHolder'>${this.phone}</span></p>`;
                }

                setUpPhone(phone) {
                    this.footerPhoneInfo.querySelector('#footerPhonePlaceHolder').innerHTML = phone;
                }
            }

            const createHeaderElement = (tag) => {
                headerElement = new HeaderPhone(tag);
                footerElement = new FooterPhone(tag);

            };
            createHeaderElement('app');

            const getData = (url, callback) => {
                // here we can use "async/await" + "fetch" + "Promises"
                // or $.get
                const xhr = new XMLHttpRequest();
                xhr.open('GET', url, true);
                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        const data = JSON.parse(xhr.responseText);
                        callback(data);
                    } else if (xhr.readyState === 4) {
                        console.error('Error:', xhr.statusText);
                    }
                };
                xhr.send();
            }

            // instead of GeoLocationDB we could use navigator.geolocation.getCurrentPosition(...) if it's available
            // and user would be willing to allow using his/her location.
            // or use third-party IP geolocation API, although the precision is not quite accurate...
            const localeData = getData('https://geolocation-db.com/json/', function(locationResponse) {
                if (locationResponse.longitude && locationResponse.latitude) {
                    getData('http://127.0.0.1:8077/phone/' + locationResponse.longitude + '/' + locationResponse.latitude,
                        function(phoneResponse) {
                        headerElement.headerPhoneInfo.setUpPhone(phoneResponse);
                        footerElement.footerPhoneInfo.setUpPhone(phoneResponse);
                    });
                }
            });
        </script>
    {% endblock %}
</html>
